<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Feliz Cumplea√±os</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; color: white; font-family: sans-serif; }
        #video_local { position: fixed; bottom: 20px; right: 20px; width: 180px; height: 135px; border: 2px solid #0ff; border-radius: 10px; transform: scaleX(-1); z-index: 10; object-fit: cover; }
        #mensaje { position: fixed; top: 20px; left: 20px; z-index: 5; }
    </style>
</head>
<body>
    <div id="mensaje">
        <h1 id="aviso">Cargando...</h1>
        <p id="sub">Mueve tu mano al verte en el cuadro</p>
    </div>
    <video id="video_local" autoplay playsinline></video>

<script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    camera.position.z = 15;

    const count = 5000;
    const geo = new THREE.BufferGeometry();
    const pos = new Float32Array(count * 3);
    const targets = new Float32Array(count * 3);
    for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*40;
    geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
    const points = new THREE.Points(geo, new THREE.PointsMaterial({size: 0.08, color: 0x00ffff, transparent: true, blending: THREE.AdditiveBlending}));
    scene.add(points);

    for(let i=0; i<count; i++) {
        let i3 = i*3;
        if(i < count*0.6) {
            let p = Math.acos(-1+(2*i)/(count*0.6)), t = Math.sqrt(count*0.6*Math.PI)*p;
            targets[i3] = Math.cos(t)*Math.sin(p)*4; targets[i3+1] = Math.sin(t)*Math.sin(p)*4; targets[i3+2] = Math.cos(p)*4;
        } else {
            let a = Math.random()*Math.PI*2, r = 6+Math.random()*2;
            targets[i3] = Math.cos(a)*r; targets[i3+1] = (Math.random()-0.5)*0.2; targets[i3+2] = Math.sin(a)*r;
        }
    }

    let handX = 0, handY = 0;

    async function setup() {
        const hands = new Hands({locateFile: (file) => "https://cdn.jsdelivr.net/npm/@mediapipe/hands/" + file});
        hands.setOptions({maxNumHands: 1, minDetectionConfidence: 0.5});
        hands.onResults(res => {
            document.getElementById('aviso').innerText = "¬°FELIZ CUMPLEA√ëOS DANIEL!";
            if(res.multiHandLandmarks && res.multiHandLandmarks[0]) {
                document.getElementById('sub').innerText = "¬°Mano detectada! ü™ê";
                let m = res.multiHandLandmarks[0][9];
                handX = (m.x - 0.5) * 35; handY = -(m.y - 0.5) * 25;
            }
        });

        const video = document.getElementById('video_local');
        const cam = new Camera(video, {
            onFrame: async () => { await hands.send({image: video}); },
            width: 640, height: 480
        });
        cam.start();
    }

    window.onload = setup;

    function draw() {
        requestAnimationFrame(draw);
        const p = geo.attributes.position.array;
        for(let i=0; i<count*3; i++) p[i] += (targets[i] - p[i]) * 0.05;
        points.position.x += (handX - points.position.x) * 0.1;
        points.position.y += (handY - points.position.y) * 0.1;
        points.rotation.y += 0.005;
        geo.attributes.position.needsUpdate = true;
        renderer.render(scene, camera);
    }
    draw();
</script>
</body>
</html>
